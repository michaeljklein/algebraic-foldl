<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Parser</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-comment">-- newtype LineNo = LineNo { unLineNo :: Natural } deriving (Eq, Ord, Enum, Show)</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-comment">-- newtype LinesT w m a = LineT { runLinesT :: MaybeT m (EnvT LineNo w a) } deriving (Eq, Ord, Show, Functor, Applicative, Monad, MonadTrans, MonadFail, MonadFix)</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">-- -- EmptyLine | Line { lineNo :: !Natural, line :: a }</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- type Line w = LinesT w Identity</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-comment">-- runLine :: Line a -&gt; Maybe (Env LineNo a)</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- runLine = extract . runMaybeT . runLineT</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-comment">-- a -&gt; [a] -&gt; [a]</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-comment">-- f0 = \x -&gt; (0 : x)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">-- f1 = \x -&gt; (0 : 1 : x)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-comment">-- [a] -&gt; [a]</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-comment">-- snocList :: a -&gt; Builder [] a -&gt; Builder [] a</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- snocList a f = \xs -&gt; f (x : xs)</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-comment">-- snocNonEmpty :: Builder NonEmpty a -&gt; Builder NonEmpty a</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- snocNonEmpty _</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-comment">-- foldLineT :: FoldE (w Char) (Maybe (Line NonEmpty (w Char)))</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">-- -- | Isn't this pretty?</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- listLinesT :: Comonad w =&gt; Fold (w Char) (LinesT NonEmpty [] (w Char))</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- listLinesT = LinesT . MaybeT &lt;$&gt; toFoldE list . foldLineT</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">-- newtype StringT m a = StringT { runStringT :: _ }</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">-- Flock prototype parser:</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- - Lines</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- - Strings</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- - Pre-spaces: space character literal: &quot;' '&quot; (tabs and other non &quot; \r\n&quot; whitespace are treated as individual spaces)</span><span>
</span><a name="line-43"></a><span class="hs-comment">-- - Spaces (indents)</span><span>
</span><a name="line-44"></a><span class="hs-comment">-- - Blocks (non-indented line, followed by 0+ indented blocks)</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- - Pre-matching: Parse &quot;()[]{}&quot; character literals</span><span>
</span><a name="line-46"></a><span class="hs-comment">-- - Matched (inside blocks): Parentheses, Brackets, Braces</span><span>
</span><a name="line-47"></a><span class="hs-comment">--   * Can only match deeper, i.e. these are allowed:</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- ```haskell</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- \r -&gt; {(a, b)</span><span>
</span><a name="line-51"></a><span class="hs-comment">--   :  even a</span><span>
</span><a name="line-52"></a><span class="hs-comment">--   , (a, b) &lt;- r</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- }</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- ```haskell</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- \r -&gt; {(a, b)</span><span>
</span><a name="line-58"></a><span class="hs-comment">--   :  even a</span><span>
</span><a name="line-59"></a><span class="hs-comment">--   , (a, b) &lt;- r</span><span>
</span><a name="line-60"></a><span class="hs-comment">--   }</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- But this isn't:</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- ```haskell</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- foo = bar</span><span>
</span><a name="line-67"></a><span class="hs-comment">--   where</span><span>
</span><a name="line-68"></a><span class="hs-comment">--     bar = \r -&gt; {(a, b)</span><span>
</span><a name="line-69"></a><span class="hs-comment">--       :  even a</span><span>
</span><a name="line-70"></a><span class="hs-comment">--       , (a, b) &lt;- r</span><span>
</span><a name="line-71"></a><span class="hs-comment">--   }</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a></pre></body></html>